---
title: OS Develop 8
date: 2022-09-07 10:46:23
tags:
   - IT-Basics
   - OS
---

### 简介
本章讨论线程。


### 线程本质
线程本质是由调度器调度，作为执行流在CPU上执行的代码块。线程的意义在于抢时间片提高进程运行速度和避免阻塞。


### 轻量级进程
进程和线程都是执行流，不过相对于进程而言，线程没有自己的地址空间，需要依赖进程而活，所以又被称作“轻量级进程”。它们都具备独立寄存器资源和独立的栈空间，因此线程也可以像进程那样调用其他函数。

### PCB(Process Control Block)
记录进程和线程信息的数据结构，基本内容包括：
- 寄存器映像
- 栈
- 栈指针
- pid
- 进程状态
- 优先级
- 时间片
- 打开的文件描述符
- 父进程

### 状态机
OS把线程不同执行阶段划分为不同的状态，在特定条件下，不同状态间可以转移。状态的定义主要是给调度器来使用的。
{% asset_img thread_state.png cpu workflow %}


### 线程实现
- 分配1页(4KB)的内存


### 线程调度
1，时钟中断处理函数
2，实现调度器schedule
3，实现任务切换函数


### 线程安全
由于同一进程中的线程共享资源，会存在资源竞争，引发线程安全问题。



### 阻塞和唤醒




### 锁